
<ng-template #modalContent let-c="close" let-d="dismiss" id="modal-container">
  <div class="modal-header">
    <h3 class="modal-title">Revision de evento</h3>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="page-body">
    <div class="card">
      <div class="card-block">
        <form #reviewForm="ngForm" (ngSubmit)="guardarRevision()">
          <div class="form-row col-md-12">
            <div class="form-group col-md-12">
              <label>Observaciones</label>
              <div class="input-group">
                <!-- <textarea disabled="true" id="limitProp" name="limitProp" rows="4" cols="80" #vehicleClass="ngModel" [(ngModel)]='categoria.description' > {{ categoria.description }} </textarea> -->
                <textarea id="objReview" name="objReview" #objReview="ngModel" rows="4" cols="80" [(ngModel)]="objReview.observaciones" >{{ objReview.observaciones }}</textarea>
              </div>
            </div>
          </div>
          <!-- <div class="form-row col-md-12">
            <div class="input-group">
              <span class="input-group-addon" style="float:left;"><i class="fa fa-industry"></i></span>
              <input type="text" class="form-control" id="typeService" name="typeService" [(ngModel)]="objReview.typeService" placeholder="Digite el nombre de la empresa" #typeService="ngModel">
            </div>
          </div> -->
          <div class="form-row col-md-12">
            <div class="form-group col-md-3">
              <button id="guardarRevision" class="btn btn-primary m-b-20">Guardar</button>
            </div>
          </div>

        </form>      
      </div>
    </div>
  </div> 
</ng-template>


<ng-template #modalContentAll let-c="close" let-d="dismiss" id="modal-container">
  <div class="modal-header">
    <h3 class="modal-title">Revision de evento</h3>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="page-body">
    <div class="card">
      <div class="card-block">
        <form #reviewForm="ngForm" (ngSubmit)="guardarRevisionCheck()">
          <div class="form-row col-md-12">
            <div class="form-group col-md-12">
              <label>Observaciones</label>
              <div class="input-group">
                <!-- <textarea disabled="true" id="limitProp" name="limitProp" rows="4" cols="80" #vehicleClass="ngModel" [(ngModel)]='categoria.description' > {{ categoria.description }} </textarea> -->
                <textarea id="objReviewAll" name="objReviewAll" #objReview="ngModel" rows="4" cols="80" [(ngModel)]="objReviewAll.observaciones" >{{ objReviewAll.observaciones }}</textarea>
              </div>
            </div>
          </div>
          <div class="form-row col-md-12">
            <div class="form-group col-md-3">
              <button id="guardarRevisionCheck" class="btn btn-primary m-b-20">Guardar</button>
            </div>
          </div>

        </form>      
      </div>
    </div>
  </div> 
</ng-template>





<div class="page-body">
  <div class="card">
    <div class="card-header">
      <h5>Lista de eventos</h5>
    </div>
    <div class="card-block">
      
        <form #reportForm="ngForm" (ngSubmit)="reportForm.form.valid && filterReport()">
          <div class="form-row col-md-12">
            <div class="form-group col-md-4">
              <label>Tipo de evento</label>
              <div class="input-group">
                <ng-select class="customEventType" name="eventType" id="eventType" 
                  [items]="eventTypes"
                  [virtualScroll]="true"
                  [loading]="loading1"
                  bindLabel="event"
                  bindValue="id"
                  placeholder="-Seleccione evento-"
                  [(ngModel)]="event.id"
                  (scrollToEnd)="fetchMore_1($event)" #id="ngModel">
                  <ng-template ng-header-tmp>
                    <small class="form-text text-muted">{{eventTypesBuffer.length}} de {{eventTypes.length}}</small>
                  </ng-template>
                  <ng-template ng-option-tmp let-item="item" let-index="index">
                    {{item.event}}
                  </ng-template>
                </ng-select>
              </div>          
            </div>

            <div class="form-group col-md-5">
              <label>Conductor</label>
              <div class="input-group">
                <ng-select class="customDriver" name="driver" id="driver" [items]="drivers"
                  [virtualScroll]="true"
                  [loading]="loading1"
                  bindLabel="description"
                  bindValue="thirdId"
                  placeholder="-Seleccione conductor-"
                  [(ngModel)]="event.thirdId"
                  (scrollToEnd)="fetchMore_1($event)" #thirdId="ngModel">
                  <ng-template ng-header-tmp>
                    <small class="form-text text-muted">{{driversBuffer.length}} de {{drivers.length}}</small>
                  </ng-template>
                  <ng-template ng-option-tmp let-item="item" let-index="index">
                    {{item.description}}
                  </ng-template>
                </ng-select>
              </div>
            </div>

            <div class="form-group col-md-3">
              <label>Placa</label>
              <div class="input-group">
                <ng-select class="customPlate" name="plate" id="plate" [items]="plates"
                  [virtualScroll]="true"
                  [loading]="loading1"
                  bindLabel="plate"
                  bindValue="plateId"
                  placeholder="-Placa-"
                  [(ngModel)]="event.plateId"
                  (scrollToEnd)="fetchMore_1($event)" #plate="ngModel">
                  <ng-template ng-header-tmp>
                    <small class="form-text text-muted">{{platesBuffer.length}} de {{plates.length}}</small>
                  </ng-template>
                  <ng-template ng-option-tmp let-item="item" let-index="index">
                    {{item.plate}}
                  </ng-template>
                </ng-select>
              </div>          
            </div>

            <div class="form-group col-md-3">
              <label >  </label>
              <div class="input-group">
              <!-- <a _ngcontent-c2="" class="btn btn-primary m-b-20" (click)="filterEvent($event)">
                &nbsp;Buscar
              </a> -->

              <button type="button" class="btn btn-primary m-b-20" (click)="filterEvent($event)">Buscar</button>

              </div>
            </div>
          </div>
        </form>

        <div class="form-row col-md-12">
          <div class="form-group col-md-3">
            <button (click)="openModalAll(modalContentAll)"  class="btn btn-primary m-b-20">Revisar seleccionados</button>
          </div>
        </div>
        <div class="dt-responsive table-responsive">
          <table id="base-tbl" class="table">
            <thead>
            <tr>
              <th>Evento</th>
              <th><input type="checkbox" onclick="marcar(this);"/></th>
              <th>Revisi贸n</th>
              <th>Viaje</th>
              <th>Vehiculo</th>
              <th>Conductor</th>
              <th>Fecha/Hora</th>
              <th>Ubicacion</th>
            </tr>
            </thead>

            

            <tbody>
            <tr style="height: 100px;">
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
                   

              <!-- <td (click)="openModal(modalContent,u.idEvent)" style="padding-left: : 0;padding-right: 0; text-align: center;">
                <a>
                  <i class="icofont icofont-eye-alt" disabled="true"></i>
                </a>
              </td> -->


            <tr *ngFor="let u of eventos"> 
              <td><span [ngClass]= u.classEventType style="padding-left: 0.5;padding-right: 0.5">{{u.event}}</span></td>
              <td *ngIf="u.valReview === 1" style="padding-right: 0; padding-left: 0"><input disabled="true" type="checkbox"/></td>
              <td *ngIf="u.valReview === 0" style="padding-right: 0; padding-left: 0"><input type="checkbox" value="{{ u.idEvent }}" /></td>
              <td *ngIf="u.valReview === 1">
                <p style="text-align: center;"> 
                  <span class="mytooltip tooltip-effect-5">
                    <span class="tooltip-item btn btn-warning">Revisi贸n</span>
                    <span class="tooltip-content clearfix" style="width: 300px;font-size: 10px; position: absolute;z-index: 2;padding: 0">
                      <span class="tooltip-text" style="text-align: center;width: 300px;padding: 0">
                        <h6>Fecha revisi贸n: </h6>
                        <p style="font-size: 8px">{{ u.dateReview }}</p>

                        <h6>Usuario revisi贸n: </h6>
                        <p style="font-size: 8px">{{ u.userReview }}</p>

                        <h6>Observaciones: </h6>
                        <p style="font-size: 8px">{{ u.reviewObservations }} </p>
                      </span>
                    </span>
                  </span>
                </p>
              </td>

              <td (click)="openModal(modalContent,u.idEvent)" *ngIf="u.valReview === 0">
                <p style="text-align: center;">
                  <span class="mytooltip tooltip-effect-2">
                    <span class="tooltip-item btn btn-primary">Revisar</span>
                  </span>
                </p>
              </td>
              <td>{{u.travel}}</td>
              <td>{{u.vehicle}}</td>
              <td style="padding-right:0; padding-left: 0; font-size: 10px">{{u.driver}}</td>
              <td>{{u.dateEvent}} {{u.dateTimeEvent}}</td>
              <!--<td>{{ u.location.replace('Long:', '').replace('Lat', '') }}</td>-->
              <td>
              <a href="https://www.google.com/maps?q={{ u.location.replace('Long:', '').replace('Lat', '').split(':')[1] }},{{ u.location.replace('Long:', '').replace('Lat', '').split(':')[0] }}" target="_blank">Ver ubicacion <i class="ti-location-pin"></i></a></td>
              
            </tr>
            </tbody>
            <tfoot>
            </tfoot>
          </table>

      </div> 
    </div>
  </div>
</div>
