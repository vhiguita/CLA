!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("css-animator/builder",[],e):"object"==typeof exports?exports["css-animator/builder"]=e():t["css-animator/builder"]=e()}("undefined"!=typeof self?self:this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};t[n].call(o.exports,o,o.exports,e);o.l=!0;return o.exports}var i={};e.m=t;e.c=i;e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})};e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};e.d(i,"a",i);return i};e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};e.p="";return e(e.s=0)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n;!function(t){t[t.Animate=0]="Animate";t[t.Show=1]="Show";t[t.Hide=2]="Hide"}(n=e.AnimationMode||(e.AnimationMode={}));var o=function(){function t(){this.animationOptions=Object.assign({},t.defaults);this.defaultOptions=Object.assign({},this.animationOptions);this.classes=[];this.activeClasses=new Map;this.listeners=new Map;this.timeouts=new Map;this.styles=new Map;this.log("AnimationBuilder created.")}t.prototype.show=function(t){return this.animate(t,n.Show)};t.prototype.hide=function(t){return this.animate(t,n.Hide)};t.prototype.stop=function(t,e){void 0===e&&(e=!0);this.removeTimeouts(t);this.removeListeners(t);e&&this.reset(t,!1);return Promise.resolve(t)};t.prototype.animate=function(e,i){var o=this;void 0===i&&(i=n.Animate);if(t.disabled||this.animationOptions.disabled)return this.animateDisabled(e,i);i===n.Show&&this.hideElement(e);return new Promise(function(t,n){o.removeTimeouts(e);var s=setTimeout(function(){o.reset(e,!0,!1,!0);o.registerAnimationListeners(e,i,t,n);o.saveStyle(e);o.saveClasses(e,i);o.pinElement(e,i);o.nextFrame(function(){o.showElement(e,i);o.applyProperties(e,i)})},o.animationOptions.delay);o.addTimeout(e,s,n);o.log("Timeout "+s+" registered for element",e)})};t.prototype.reset=function(t,e,i,n){void 0===e&&(e=!0);void 0===i&&(i=!1);void 0===n&&(n=!1);if(e){this.removeTimeouts(t,i);this.removeListeners(t,n)}this.removeStyles(t);this.removeClasses(t)};t.prototype.dispose=function(){this.timeouts.forEach(function(t){for(var e=0,i=t;e<i.length;e++){var n=i[e];clearTimeout(n.timeout)}});this.listeners.forEach(function(t,e){for(var i=0,n=t;i<n.length;i++){var o=n[i];e.removeEventListener(o.eventName,o.handler)}});this.classes=[];this.styles=new Map;this.timeouts=new Map;this.listeners=new Map};t.prototype.addAnimationClass=function(t){-1===this.classes.indexOf(t)&&this.classes.push(t);return this};t.prototype.removeAnimationClass=function(t){var e=this.classes.indexOf(t);-1!==e&&this.classes.splice(e,1);return this};Object.defineProperty(t,"DEBUG",{get:function(){return t._DEBUG},set:function(e){t._DEBUG=e},enumerable:!0,configurable:!0});Object.defineProperty(t,"disabled",{get:function(){return t._disabled},set:function(e){t._disabled=e},enumerable:!0,configurable:!0});Object.defineProperty(t,"defaults",{get:function(){return t._defaults},enumerable:!0,configurable:!0});t.prototype.animateDisabled=function(t,e){e===n.Show?this.showElement(t,e):e===n.Hide&&this.hideElement(t,e);return Promise.resolve(t)};t.prototype.log=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.DEBUG&&console.log.apply(console,["css-animator:"].concat(e))};t.prototype.nextFrame=function(e){t.raf(function(){t.raf(e)})};t.prototype.camelCase=function(t){return t.toLowerCase().replace(/-(.)/g,function(t,e){return e.toUpperCase()})};t.prototype.hideElement=function(t,e){this.animationOptions.useVisibility?t.style.visibility="hidden":t.setAttribute("hidden","")};t.prototype.showElement=function(t,e){this.animationOptions.pin&&e===n.Show&&(t.style.visibility="visible");this.animationOptions.useVisibility?t.style.visibility="visible":t.removeAttribute("hidden")};t.prototype.pinElement=function(t,e){if(this.animationOptions.pin){e===n.Show&&(t.style.visibility="hidden");this.animationOptions.useVisibility||this.showElement(t);var i=this.getPosition(t);t.style.position=this.animationOptions.fixed?"fixed":"absolute";t.style.top=i.top+"px";t.style.left=i.left+"px";t.style.width=i.width+"px";t.style.height=i.height+"px";t.style.margin="0px"}};t.prototype.getPosition=function(t){var e=t.getBoundingClientRect(),i=window.getComputedStyle(t),n=t.offsetLeft,o=t.offsetTop,s=e.width-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderLeftWidth)-parseFloat(i.borderRightWidth),r=e.height-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderTopWidth)-parseFloat(i.borderBottomWidth);if(this.animationOptions.fixed){n=e.left+window.scrollX;o=e.top+window.scrollY}return{left:n,top:o,width:s,height:r}};t.prototype.registerAnimationListeners=function(t,e,i,o){var s,r=this,a=this.animationStartEvent(t),p=this.animationEndEvent(t);t.addEventListener(a,s=function(){r.log("Animation start handler fired for element",t);t.removeEventListener(a,s);return s});this.log("Registered animation start listener for element",t);var l;t.addEventListener(p,l=function(){r.log("Animation end handler fired for element",t);t.removeEventListener(p,l);r.removeListeners(t,!1);r.reset(t,!0,!1,!1);e===n.Hide&&r.hideElement(t);e===n.Show&&r.showElement(t);i(t);return l});this.log("Registered animation end listener for element",t);this.addListener(t,a,s);this.addListener(t,p,l,o)};t.prototype.addTimeout=function(t,e,i){this.timeouts.has(t)||this.timeouts.set(t,[]);this.timeouts.get(t).push({timeout:e,reject:i})};t.prototype.addListener=function(t,e,i,n){this.listeners.has(t)||this.listeners.set(t,[]);var o=Object.assign({},this.classes);this.listeners.get(t).push({eventName:e,handler:i,reject:n,classes:o})};t.prototype.removeListeners=function(t,e){var i=this;void 0===e&&(e=!1);if(this.listeners.has(t)){this.listeners.get(t).forEach(function(n){t.removeEventListener(n.eventName,n.handler);i.log("Listener "+n.eventName+" removed for element",t);e&&i.animationOptions.reject&&n.reject&&n.reject("animation_aborted")});this.listeners.delete(t)}};t.prototype.removeTimeouts=function(t,e){var i=this;void 0===e&&(e=!1);if(this.timeouts.has(t)){this.timeouts.get(t).forEach(function(n){clearTimeout(n.timeout);i.log("Timeout "+n.timeout+" removed for element",t);e&&i.animationOptions.reject&&n.reject&&n.reject("animation_aborted")});this.timeouts.delete(t)}};t.prototype.animationEndEvent=function(t){var e=document.createElement("endAnimationElement"),i={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(var n in i)if(void 0!==e.style[n])return i[n];return null};t.prototype.animationStartEvent=function(t){var e=document.createElement("startAnimationElement"),i={animation:"animationstart",OAnimation:"oAnimationStart",MozAnimation:"animationstart",WebkitAnimation:"webkitAnimationStart"};for(var n in i)if(void 0!==e.style[n])return i[n];return null};t.prototype.applyProperties=function(t,e){this.applyClasses(t,e);this.applyStyles(t,e)};t.prototype.saveStyle=function(t){var e={};for(var i in t.style)e[i]=t.style.getPropertyValue(i);this.styles.set(t,e)};t.prototype.applyStyles=function(t,e){this.applyFillMode(t);this.applyTimingFunction(t);this.applyPlayState(t);this.applyDirection(t);this.applyDuration(t);this.applyIterationCount(t)};t.prototype.removeStyles=function(t){if(this.styles.has(t)){var e=this.styles.get(t);t.removeAttribute("style");for(var i in e)t.style.setProperty(i,e[i]);this.styles.delete(t)}};t.prototype.saveClasses=function(t,e){var i=this.classes.slice(0);switch(e){case n.Show:i.push("animated-show");break;case n.Hide:i.push("animated-hide")}i.push("animated",this.animationOptions.type);this.activeClasses.set(t,i)};t.prototype.applyClasses=function(t,e){var i=this.activeClasses.get(t)||[];(n=t.classList).add.apply(n,["animated"].concat(i));var n};t.prototype.removeClasses=function(t){var e=this.activeClasses.get(t)||[];(i=t.classList).remove.apply(i,["animated","animated-show","animated-hide"].concat(e));this.activeClasses.delete(t);var i};t.prototype.applyStyle=function(t,e,i){var n=document.createElement("checkStyle"),o={standard:this.camelCase(e),webkit:this.camelCase("-webkit-"+e),mozilla:this.camelCase("-moz-"+e),opera:this.camelCase("-o-"+e),explorer:this.camelCase("-ie-"+e)};for(var s in o)if(o.hasOwnProperty(s)&&void 0!==n.style[o[s]]){t.style[o[s]]=void 0===i||null===i?null:i;break}return this};Object.defineProperty(t.prototype,"defaults",{get:function(){return this.defaultOptions},set:function(t){this.defaultOptions=t},enumerable:!0,configurable:!0});t.prototype.setDefaults=function(t){this.defaults=t;return this};Object.defineProperty(t.prototype,"options",{get:function(){return this.animationOptions},set:function(t){this.animationOptions=t},enumerable:!0,configurable:!0});t.prototype.setOptions=function(t){Object.assign(this.options,t);return this};Object.defineProperty(t.prototype,"disabled",{get:function(){return this.animationOptions.disabled},set:function(t){this.animationOptions.disabled=t},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"reject",{get:function(){return this.animationOptions.reject},set:function(t){this.animationOptions.reject=t},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"pin",{get:function(){return this.animationOptions.pin},set:function(t){this.animationOptions.pin=t},enumerable:!0,configurable:!0});t.prototype.setPin=function(t){this.pin=t;return this};Object.defineProperty(t.prototype,"useVisibility",{get:function(){return this.animationOptions.useVisibility},set:function(t){this.animationOptions.useVisibility=t},enumerable:!0,configurable:!0});t.prototype.setUseVisibility=function(t){this.useVisibility=t;return this};Object.defineProperty(t.prototype,"type",{get:function(){return this.animationOptions.type},set:function(t){this.animationOptions.type=t},enumerable:!0,configurable:!0});t.prototype.setType=function(t){this.type=t;return this};Object.defineProperty(t.prototype,"fillMode",{get:function(){return this.animationOptions.fillMode},set:function(t){this.animationOptions.fillMode=t},enumerable:!0,configurable:!0});t.prototype.setFillMode=function(t){this.fillMode=t;return this};t.prototype.applyFillMode=function(t,e){this.applyStyle(t,"animation-fill-mode",e||this.animationOptions.fillMode);return this};Object.defineProperty(t.prototype,"timingFunction",{get:function(){return this.animationOptions.timingFunction},set:function(t){this.animationOptions.timingFunction=t},enumerable:!0,configurable:!0});t.prototype.setTimingFunction=function(t){this.timingFunction=t;return this};t.prototype.applyTimingFunction=function(t,e){this.applyStyle(t,"animation-timing-function",e||this.animationOptions.timingFunction);return this};Object.defineProperty(t.prototype,"playState",{get:function(){return this.animationOptions.playState},set:function(t){this.animationOptions.playState=t},enumerable:!0,configurable:!0});t.prototype.setPlayState=function(t){this.playState=t;return this};t.prototype.applyPlayState=function(t,e){this.applyStyle(t,"animation-play-state",e||this.animationOptions.playState);return this};Object.defineProperty(t.prototype,"direction",{get:function(){return this.animationOptions.direction},set:function(t){this.animationOptions.direction=t},enumerable:!0,configurable:!0});t.prototype.setDirection=function(t){this.direction=t;return this};t.prototype.applyDirection=function(t,e){this.applyStyle(t,"animation-direction",e||this.animationOptions.direction);return this};Object.defineProperty(t.prototype,"duration",{get:function(){return this.animationOptions.duration},set:function(t){this.animationOptions.duration=t},enumerable:!0,configurable:!0});t.prototype.setDuration=function(t){this.duration=t;return this};t.prototype.applyDuration=function(t,e){this.applyStyle(t,"animation-duration",(e||this.animationOptions.duration)+"ms");return this};Object.defineProperty(t.prototype,"delay",{get:function(){return this.animationOptions.delay},set:function(t){this.animationOptions.delay=t},enumerable:!0,configurable:!0});t.prototype.setDelay=function(t){this.delay=t;return this};t.prototype.applyDelayAsStyle=function(t,e){this.applyStyle(t,"animation-delay",(e||this.animationOptions.delay)+"ms");return this};Object.defineProperty(t.prototype,"iterationCount",{get:function(){return this.animationOptions.iterationCount},set:function(t){this.animationOptions.iterationCount=t},enumerable:!0,configurable:!0});t.prototype.setIterationCount=function(t){this.iterationCount=t;return this};t.prototype.applyIterationCount=function(t,e){this.applyStyle(t,"animation-iteration-count",e||this.animationOptions.iterationCount);return this};t._DEBUG=!1;t._disabled=!1;t._defaults={disabled:!1,fixed:!1,reject:!0,useVisibility:!1,pin:!0,type:"bounce",fillMode:"none",timingFunction:"ease",playState:"running",direction:"normal",duration:1e3,delay:0,iterationCount:1};t.raf=window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout;return t}();e.AnimationBuilder=o}])});
//# sourceMappingURL=builder.min.js.map
